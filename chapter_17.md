# LOGGING SERVICES

**Logging** : recording events or messages generated by software ( kernel, services, apps, etc. ) to log files for later review.

## SYSLOG

> **!** Among the myriad of early logging protocols, syslog stood out becouse of it had a **standard message** format.

    FACILITY.PRIORITY    ACTION

**FACILITY**

| Value | Facility          | Description|
| -     | -                 | - |
| 0     | **kern**          | Generated by kernel|
| 1     | **user**          | Generated by user events|
| 2     | **mail**          | From a mail application|
| 3     | **daemon**        | From a daemon|
| 4     | **auth**          | Security/authentication messages|
| 5     | **syslog**        | From the logging application itself|
| 6     | **lpr**           | Printer messages|
| 7     | **news**          | From news applications|
| 8     | **uucp**          | From Unix-to-Unix Copy Program|
| 9     | **cron**          | From cron job scheduler|
| 10    | **authpriv**      | Security/authentication messages|
| 11    | **ftp**           | From File Transfer Protocol|
| 12    | **ntp**           | From Network Time Protocol|
| 13    | **security**      | Log audit messages|
| 14    | **console**       | Log alert messages|
| 15    | **solaris-cron**  | Another scheduling daemon|
| 16–23 | **local0–local7** | Locally defined|

**PRIORITY / SERVERITY**

| Level | Keyword       | Meaning|
| -     | -             | - |
| 0     | **emerg**     | System is unusable|
| 1     | **alert**     | Immediate action required|
| 2     | **crit**      | Critical condition (does't require immedeiate attention)|
| 3     | **err**       | Error condition (application continues)|
| 4     | **warning**   | Warning condition|
| 5     | **notice**    | Normal but significant|
| 6     | **info**      | Informational|
| 7     | **debug**     | Debug-level messages|

---

## APPLICATIONS

| Logging Service       | Description|
| -                     | - |
| **Sysklogd**          | The original syslog implementation. Includes two components:|
|                       | • `syslogd` – Monitors system and application messages|
|                       | • `klogd` – Captures kernel messages|
| **Syslog-ng**         | Enhanced syslog replacement with:|
|                       | • Advanced message filtering capabilities|
|                       | • Support for sending logs to remote hosts|
| **Rsyslog**           | A high-performance syslog replacement:|
|                       | • "R" stands for "rocket-fast."|
|                       | • Designed with a focus on speed and performance|
| **systemd-journald**  | Integrated into `systemd`:|
|                       | • Does **not** use the traditional syslog protocol|
|                       | • Collects logs from services, kernel, and standard output streams|

---

### rsyslog

- Uses the **rsyslogd** daemon to monitor and log system and application events.
- Configuration files are located in :
    + **/etc/rsyslog.conf** (main config)
    + **/etc/rsyslog.d/** (directory for **app-specific** config files)

| Rule          | Description|
| -             | - |
| **kern.crit**  | Logs all kernel messages of **critical** severity or higher (crit, alert, emerg)|
| **kern.=crit** | Logs **only** critical messages from the kernel|
| **kern.\***    | Logs **all** messages from the kernel|
| **\*.crit**    | Logs all **critical and higher** messages from all facilities|

**Available Actions**

* Write logs to a file.
* Send logs through a pipe to another application.
* Display messages on a specific terminal or system console.
* Forward logs to a remote server.
* Deliver logs to specified users.
* Broadcast messages to all users currently logged in.

---> /etc/rsyslog.conf

    kern.*                      -var/log/kern.log
    *.emerg                     :omusrmsg:*
    auth,authpriv.*             /var/log/auth.log
    *.* ; auth,authpriv.none    -/var/log/syslog

| Rule                                              | Description|
| -                                                 | - |
| `kern.*                      -/var/log/kern.log`  | Logs **all kernel messages** to `/var/log/kern.log`|
| `*.emerg                     :omusrmsg:*`         | Send **all emergency messages** to **all logged-in users**|
| `auth,authpriv.*             /var/log/auth.log`   | Logs **all authentication-related messages** to `/var/log/auth.log`|
| `*.* ; auth,authpriv.none    -/var/log/syslog`    | Logs **all messages except authentication-related ones** to `/var/log/syslog`|

> **!** The **- (dash)** before a file path tells `rsyslogd` not to sync the file after every write, improving performance by reducing disk I/O.\
> **!** However, it also introduces a risk of losing log messages if the system crashes before the data is flushed to disk.\
> **!** Over time, log files can grow very large, to manage this, the `logrotate` utility is used to periodically rotate log files.\
> **!** It splits them into numbered archive files based on file size or time intervals.

---

#### MAKING LOG ENTRIES

**`logger `**`[option] [message]`\
--> write messages to the system log from your scripts

| Option| Description |
| -     | - |
| **-i**| Include the **process ID** in the log entry|
| **-p**| Specify the event priority (severity)|
| **-t**| Add a tag to identify the source of the message|
| **-f**| Log the contents of a specified file|
| **-s**| Also send the message to STDERR|

`logger -t MyScript "Script started"`\
--->  Adds a tag `MyScript` to identify the log entry source.

`logger -p user.warning "Low disk space"`\
---> Logs a **warning** message with facility `user`

> `$ tail /var/log/syslog` --> check latest entries.
> ```
>     Feb 8 20:10:11 myhost Adam:hello world
>```
> Most distros log different events in multiple files and folders.\
> Check `/etc/rsyslog.conf` and the `/etc/rsyslog.d/` directory for configurations.

---

### systemd-journald

* Configuration file: `/etc/systemd/journald.conf`

| Setting               | Description|
| -                     | - |
| **Storage**           | - `auto`: Use `/var/log/journal/` if present; else store temporarily in `/run/log/journal/`|
|                       | - `persistent`: Create `/var/log/journal/` if missing and store logs permanently|
|                       | - `volatile`: Always store logs temporarily, even if `/var/log/journal/` exists|
| **Compress**          | Enable or disable compression of journal files|
| **ForwardToSyslog**   | Forward logs to another logger, such as `rsyslogd`|

> **!** systemd-journald stores logs in binary format. Use `journalctl` to view them.

**`journalctl `**`[ option ] [ match ]`\
--> view and query logs collected by systemd-journald.

| Option    | Description|
| -         | - |
| **-a**    | Show all available data fields in entries|
| **-e**    | Jump to the end of the journal (opens pager)|
| **-l**    | Display all printable fields in full|
| **-n N**  | Show the most recent **N** entries|
| **-r**    | Display entries in reverse chronological order|

| Match                     | Description|
| -                         | - |
| **PRIORITY=N**            | Show entries with priority level **N**|
| **_UID=userID**           | Show entries from a specific user ID|
| **_HOSTNAME=host**        | Show entries from a specific host|
| **_TRANSPORT=method**     | Show entries received via a specific transport method<br>**kernel** : how only kernel-related entries|
| **_UDEV_SYSNAME=device**  | Show entries related to a specific device|
| **OBJECT_PID=pid**        | Show entries from a specific application process (PID)|

`$ journalctl -r _TRANSPORT=kernal`

# LOGGING SERVICES

> Logging direct short messages that indicate what events happen to users, files or even remote hostes for storage.

## SYSLOG

Among the myriad of early logging protocols, syslog stood out becouse of it had a standard message format.

**Type of event "facility value"**

    0       kern            generated by kernal.
    1       user            generated by user event.
    2       mail            from a mail app.
    3       daemon          from a daemon.
    4       auth            security / authentication messages.
    5       syslog          from the logging app, itself.
    6       lpr             printer messages.
    7       news            from news applications.
    8       uucp            from unix to unix copy program.
    9       cron            from cron job scheduler.
    10      authpriv        security / authentication messages.
    11      ftp             from file transfer protocol.
    12      ntp             from network time protocol.
    13      security        log audit messgaes.
    14      console         log alert messages.
    15      solaris-cron    another scheduling demon.
    16-23   local0-local7   locally defined.

**Severity**

    0       emerg           event causes system to be unusable.
    1       alert           event require immediate attention.
    2       crit            critical event, doesn't require immediate attention.
    3       err             error, application continues.
    4       warning         non normal condition in the system or app.
    5       notice          normal but significant condition.
    6       info            informational message.
    7       debug           debugging messages.


## APPLICATIONS

- **Sysklogd**
    * original syslog app.
    * include syslogd & klogd.
    * syslogd - monitor system & apps.
    * klogd - monitor kernal.

- **Syslogd-ng**
    * added message filtering.
    * added sending messages to remote hosts.

- **Rsyslog**
    * r stand for rocket fast.
    * focus on speed.

- **Systemd-journald**
    * part od systemd.
    * does not follow syslog protocol.

### rsyslog

* use rsyslogd to monitor for events.
* config - **/etc/rsylog.conf** or **/etc/rsyslog.d/**
* using the config directory allows seperate applications own configs.

> format is **facility.priority action**.\
> **kern.crit** - log all events below crit level. ( crit / alert / emerg ) from kernal.\
> **kern.=crit** - log only crit events from kernal.\
> **kern.\*** - log all events from kernal.\
> **\*.crit** - log all events below crit level.


Available Actions.

- forward to a file.
- pipe to an application.
- display on terminal or console.
- send to remote host.
- send to a list of users.
- send to all logged-in users.

.

    kern.*                      -var/log/kern.log
    *.emerg                     :omusrmsg:*
    auth,authpriv.*             /var/log/auth.log
    *.* ; auth,authpriv.none    -/var/log/syslog


**According to above configuration.**

All kernal messages will be logged to **/var/log/kern.log** file.\
the **( - )** sign indicate to rsyslogd, not to sync the file after every write.\
this helps increase performance, but the message may be lost if the system crashes before next normal sync.\

All emergency level messages will be sent to all logged in users.

All messages from auth & authpriv is sent to **/var/log/auth.log**.

All messages except auth & authpriv are sent to **/var/log/syslog**.

> in time logs accumulate a large number of entries, to prevent that the **logrotate** utility\
> periodically split the log files into numbered archive files, based on time or size of the file.


#### MAKING LOG ENTRIES

In custom bash scripts,

    logger [options] message

    -i      process id.
    -p      event priority.
    -t      tag.
    -f      send to a file.
    -s      send to STDERR.

`$ logger hello world`

`$ tail /var/log/syslog`

    Feb 8 20:10:11 myhost Adam:hello world


most distros use several files and folders to log different types of events.\
check **/etc/rsyslog.conf** file and **/etc/rsyslog.d** directory.

### systemd-journald

- config **/etc/systemd/journald**
- **Storage** setting
    * auto - look for **/var/log/journal/**. if not found, store temporarily in **/run/log/journal/**.
    * persistent - create **/var/log/journal/** if not found and store permenently.
    * volatile - store temporarily, even if **/var/log/journal/** exists.

- **Compress** setting
    * compress or not, journal files.

- **ForwardToSyslog** setting
    * forward messages to another logging programm, such as **rsyslogd**.


> **!** systemd-journald doesn't store entries in text format.
> instead use **journalctl** to view messages.

**journalctl [ options ] [ matches ]**

    Options

    -a          display all data fields.
    -e          jump to end of journal, use pager utility to view entires.
    -l          display all printable fields.
    -n N        show most recent N number of entries.
    -r          reverse the order of entries in output.

    Matches

    Fields              match specific fields in the journal.
    Kernal              only kernal entires.
    PRIORITY=N          entries with N priority.
    _UID=userID         entries from a specific user.
    _HOSTNAME=host      entries from a specific host.
    _TRANSPORT=trans    entries recieved by a specific transport method.
    _UDEV_SYSNAME=dev   entries forma specific device.
    OBJECT_PID=pid      entries from a specific application.

`$ journalctl -r _TRANSPORT=kernal`
